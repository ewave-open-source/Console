"use strict";function guid(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function toArray(e){var t=[];for(var n in e)t.push(e[n]);return t}function isFunction(e){var t={};return e&&"[object Function]"===t.toString.call(e)}function reviveType(e){var t=null;if("string"==typeof e&&(t=e.match(regexIso8601))){var n=Date.parse(t[0]);if(!isNaN(n))return new Date(n)}return e}var loader_count=0,nodulus_dependecies=["infinite-scroll","anguFixedHeaderTable","m43nu.auto-height","mgcrea.ngStrap","mj.scrollingTabs","ui.bootstrap","ui.ace","ngSanitize","ngRoute","ngResource","angular.filter","angularBootstrapNavTree","treeControl","ngMaterial","ngMessages","ngAnimate","RecursionHelper","DynamicDataSerivces","Cache","IDE","pascalprecht.translate","cfp.hotkeys"],delay_bootstraping=!1;angular.element(document).ready(function(){for(var e in nodulus_mapping){for(var t=nodulus_mapping[e],n=0;n<t.scripts.length;n++){delay_bootstraping=!0;var i=document.createElement("script");i.type="text/javascript",i.async=!1,i.defer=!0,i.src=e+"/scripts/"+t.scripts[n],i.onload=function(){loader_count--,0==loader_count&&angular.bootstrap(document,["nodulus"])},document.getElementsByTagName("body")[0].appendChild(i),loader_count++}if(t.styles)for(var n=0;n<t.styles.length;n++){var a=document.createElement("link");a.setAttribute("rel","stylesheet"),a.setAttribute("type","text/css"),a.setAttribute("href",e+"/styles/"+t.styles[n]),document.getElementsByTagName("head")[0].appendChild(a)}for(var n=0;n<t.dependencies.length;n++)nodulus_dependecies.push(t.dependencies[n])}delay_bootstraping||angular.element(document).ready(function(){angular.bootstrap(document,["nodulus"])})}),location.origin||(location.origin=location.protocol+"//"+location.host);var apiUrl="@nodulus/api/",logedinuser={},LNG={},socket={},socketsInitialized=!1,mod,nodulus={},regModules=["ng"];mod=angular.module("infinite-scroll",[]),mod.directive("infiniteScroll",["$rootScope","$window","$timeout",function(e,t,n){return{link:function(i,a,o){var r,s,l,c;return t=angular.element(t),l=0,null!=o.infiniteScrollDistance&&i.$watch(o.infiniteScrollDistance,function(e){return l=parseInt(e,10)}),c=!0,r=!1,null!=o.infiniteScrollDisabled&&i.$watch(o.infiniteScrollDisabled,function(e){if(c=!e,c&&r)return r=!1,s()}),s=function(){var n,s,u,d;return d=t.height()+t.scrollTop(),n=a.offset().top+a.height(),s=n-d,u=s<=t.height()*l,u&&c?e.$$phase?i.$eval(o.infiniteScroll):i.$apply(o.infiniteScroll):u?r=!0:void 0},t.on("scroll",s),i.$on("$destroy",function(){return t.off("scroll",s)}),n(function(){return o.infiniteScrollImmediateCheck?i.$eval(o.infiniteScrollImmediateCheck)?s():void 0:s()},0)}}}]);var providers={};console.debug("nodulus_dependecies",nodulus_dependecies);var DynamicData=angular.module("nodulus",nodulus_dependecies).config(["$controllerProvider","$resourceProvider","$routeProvider","$mdThemingProvider","$compileProvider","$provide","$injector","$translateProvider","hotkeysProvider",function(e,t,n,i,a,o,r,s,l){l.includeCheatSheet=!0,providers={$controllerProvider:e,$compileProvider:a,$provide:o,$injector:r},s.useSanitizeValueStrategy(null),s.useUrlLoader("/@nodulus/translations/languages");var c=localStorage.getItem("lcid"),u={1033:{name:"english",shortname:"eng",lcid:1033,align:"left",direction:"ltr",alignInvert:"right",directionInvert:"rtl"},1037:{name:"hebrew",shortname:"heb",lcid:1037,align:"right",direction:"rtl",alignInvert:"left",directionInvert:"ltr"}};null===c&&(c=1033);var d=u[c];s.use(d.shortname),s.preferredLanguage(d.shortname),s.fallbackLanguage(d.shortname),n.when("/setup",{templateUrl:"partials/setup.html",controller:"setupController"}).when("/login",{templateUrl:"partials/login.html",controller:"loginController"}).when("/register",{templateUrl:"partials/register.html",controller:"registerController"}).when("/manage",{templateUrl:"partials/manage.html",controller:"ideController"}).otherwise({redirectTo:"/manage"})}]).provider("$Language",[function(){this.$get=["$resource",function(e){var t=e(apiUrl+"/Languages/",{lcid:"@lcid"});return{language:null,getActive:function(){return this.language},resourceSet:null,set:function(e){return this.language=e,this.getResourceSet(e)},getByLCID:function(e){if(null==e)return this.languages[0];for(var t=0;t<this.languages.length;t++)if(this.languages[t].lcid==e)return this.languages[t]},getSetring:function(e){return this.resourceSet[e]},getResourceSet:function(e){var n=t.get({lcid:e.lcid});return n},languages:[{name:"english",shortname:"eng",lcid:1033,align:"left",direction:"ltr",alignInvert:"right",directionInvert:"rtl"},{name:"hebrew",shortname:"heb",lcid:1037,align:"right",direction:"rtl",alignInvert:"left",directionInvert:"ltr"}]}}]}]).provider("$DataTable",[function(){this.$get=["$resource",function(e){var t=e(apiUrl+"/DataTable/",{});return{TablesDic:{},Tables:[],GetTableName:function(e){return TablesDic[""+e].name},GetTableIcon:function(e){return"images/gallery4.png"},Load:function(){var e=this.Tables,n=this.TablesDic;t.get({},function(t){e=t.Tables;for(var i=0;i<e.length;i++)n[""+e[i].Id]=e[i]})}}}]}]).provider("$Config",function(){var e;return{setType:function(t){e=t},$get:["$http",function(e){var t=this;return e.get("../../config/client.json").success(function(e){t.site=e}),{ready:function(t){var n=this;void 0===this.site?e.get("../../config/client.json").success(function(e){n.site=e,t()}):t()},site:t.site}}]}}).provider("$Theme",[function(){this.$get=function(){return{setTheme:function(e){this.theme=e},getTheme:function(){return this.theme}}}}]).factory("$Status",[function(){return function(){return[{id:1,name:"Air"},{id:2,name:"Edit"}]}}]).provider("$Screensize",[function(){this.$get=function(){return{height:function(){return $(window).height()-100}}}}]).controller("shellController",["$scope","$mdDialog","$resource","$location","$compile","$Alerts","$Language","$Theme","$User","$Models","$Cache","$Config","$IDE","$nodulus",function(e,t,n,i,a,o,r,s,l,c,u,d,m,g){e.$Alerts=o,e.$IDE=m,e.$nodulus=g,nodulus=e.$nodulus,u.ready("schemas",function(e){for(var t={},n=0;n<e.length;n++)t[e[n].name]=e[n];u.setCache("schemasByName",t)}),e.$User=l;var h=localStorage.getItem("theme");if(null===h&&(h="default"),s.setTheme(h),void 0!==h){var p="themes/"+h+"/bootstrap.min.css";$('link[id="mainthemefile"]').attr("href",p),localStorage.setItem("theme",h)}e.PaneHeight=$(window).height()-110,window.onresize=function(){e.PaneHeight=$(window).height()-110,e.$apply(e.PaneHeight)};var f=localStorage.getItem("lcid");e.Language=r.getByLCID(f),r.set(e.Language).$promise.then(function(t){var n={},i=angular.fromJson(t.Results);if(void 0!==i)for(var a=0;a<i.length;a++)n[i[a].Key]=i[a].Value;e.LNG=n}),e.Module={},e.initSocketEvents=function(){d.ready(function(){socketsInitialized||"undefined"==typeof io||(socket=io(location.origin),null!==l.User&&l.User._id&&socket.emit("console connect",{UserId:l.User._id}),socket.on("console connected",function(t){e.$apply(function(){e.$Alerts.add({type:"success",msg:"client connected",autoClose:5e3,icon:"fa fa-check"})})}))})},e.initSocketEvents(),e.LoadSettingsPage=function(){m.ShowLobby({_id:"settings",label:"Settings"},"partials/settings.html")},e.LoadModulesPage=function(){m.ShowLobby({_id:"modules",label:"Modules"},"@nodulus/modules/modules.html")},n("nodulus.json").get({},function(){},function(){i.url("/setup")})}]).controller("loginController",["$scope","$resource","$location","$mdToast","$animate","$mdDialog","$Theme","$User",function(e,t,n,i,a,o,r,s){e.$Theme=r,void 0!==localStorage.getItem("ApiUser")&&(logedinuser=JSON.parse(localStorage.getItem("ApiUser")),null!=logedinuser&&void 0!==logedinuser&&n.path("/manage"),o.show({controller:["$scope","$resource","$mdToast","$location",function(e,t,n,i){e.Login=function(){if(!e.LoginForm.$dirty||!e.LoginForm.$invalid){e.LoginLoading=!0;var a=t("@nodulus/users/login/",{Email:"@email",Password:"@password"});a.save({Email:e.Username,Password:e.Password},function(t){e.LoginLoading=!1,null!=t&&void 0===t.error?(o.cancel(),s.set(t),i.path("/manage")):n.show({template:"<md-toast>Incorrect user name or password.</md-toast>",hideDelay:2e3,position:"bottom"})})}}}],templateUrl:"partials/manage/dialogs/login.html"})),e.Email="",e.Password="",e.CookieTimeOut=0,e.LoginLoading=!1,e.Login=function(){if(!e.LoginForm.$dirty||!e.LoginForm.$invalid){e.LoginLoading=!0;var a=t("@nodulus/users/Login/",{Email:"@email",Password:"@password"});a.get({Email:e.Username,Password:e.Password},function(t){e.LoginLoading=!1,null!=t&&void 0!==t._id?(localStorage.setItem("ApiUser",JSON.stringify(t)),n.path("/manage")):i.show({template:"<md-toast>Incorrect user name or password.</md-toast>",hideDelay:2e3,position:"bottom"})})}}}]).controller("registerController",["$scope","$resource","$location","$mdToast","$animate","$mdDialog",function(e,t,n,i,a,o){o.show({controller:["$scope","$resource","$mdToast","$location",function(e,t,n,i){e.Register=function(){if(!e.RegisterForm.$dirty||!e.RegisterForm.$invalid){e.RegisterLoading=!0;var a=t("@nodulus/users/register/",{Email:"@email",Password:"@password"});a.save({Email:e.Username,Password:e.Password},function(t){e.RegisterLoading=!1,null!=t&&void 0!==t._id?(localStorage.setItem("ApiUser",JSON.stringify(t)),o.hide(),i.path("/manage")):n.show({template:"<md-toast>"+t.error.message+"</md-toast>",hideDelay:2e3,position:"bottom"})})}}}],templateUrl:"partials/manage/dialogs/register.html"});e.Email="",e.Password="",e.CookieTimeOut=0,e.LoginLoading=!1}]).service("$User",["$resource","$Config",function(e,t){var n=this;this.set=function(e){e.Password=null,localStorage.setItem("ApiUser",JSON.stringify(e)),n.user=e},this.get=function(){var e=localStorage.getItem("ApiUser");return void 0!==e&&JSON.parse(e)},this.User=this.get(),this.ready=function(e){void 0!==n.Patients?e():this.LoadPatients(e)}}]).service("$Alerts",["$resource","$Config","$timeout",function(e,t,n){var i=this;i.alerts=[],this.add=function(e){i.alerts.push(e),e.autoClose&&n(function(){i.remove(e)},e.autoClose)},this.remove=function(e){i.alerts.splice(i.alerts.indexOf(e),1)}}]).service("$nodulus",["$resource","$Config","$injector","$log",function(e,t,n,i){this.register=function(e){var t,a,o,r,s,l,c,u;if(e){var d=[];for(o=e.length-1;o>=0;o--){s=e[o],regModules.push(s),l=angular.module(s),DynamicData.requires.push(s),d=d.concat(l._runBlocks);try{for(r=l._invokeQueue,t=0,a=r.length;t<a;t++){if(c=r[t],!providers.hasOwnProperty(c[0]))return i.error("unsupported provider "+c[0]);u=providers[c[0]],u[c[1]].apply(u,c[2])}}catch(e){throw e.message&&(e.message+=" from "+s),i.error(e.message),e}e.pop()}angular.forEach(d,function(e){n.invoke(e)})}return null}}]).directive("navLoader",["$compile",function(e){return{restrict:"E",scope:{navname:"=",module:"="},link:function(t,n,i){var a="<div><"+t.navname+"></"+t.navname+"></div>",o=e(a)(t);n.append(o)}}}]).controller("setupController",["$scope","$uibModal",function(e,t){var n=this;n.closeAlert=function(){n.reason=null},n.open=function(){var e=t.open({templateUrl:"setup/partials/wizard.html",controller:"ModalCtrl"});e.result.then(function(e){n.closeAlert(),n.summary=e},function(e){n.reason=e})},n.open(),e.app=n}]).controller("ModalCtrl",["$scope","$location","$uibModalInstance","$Language","$Theme","$translate","$resource",function(e,t,n,i,a,o,r){var s={};s.steps=["Welcome","Persistence mode","Admin credentials"],s.step=0,s.isFirstStep=function(){return 0===s.step},s.isLastStep=function(){return s.step===s.steps.length-1},s.isCurrentStep=function(e){return s.step===e},s.setCurrentStep=function(e){s.step=e},s.getCurrentStep=function(){return s.steps[s.step]},s.getNextLabel=function(){return s.isLastStep()?"Submit":"Next"},s.handlePrevious=function(){s.step-=s.isFirstStep()?0:1},s.handleNext=function(){if(s.isLastStep())if(!s.database||""===s.database.diskdb&&""==s.database.mongodb)s.step=1;else{var e=r("/nodulus/setup");e.save(s,function(e){t.url("/login")}),n.close(s.wizard)}else s.step+=1},s.dismiss=function(e){$modalInstance.dismiss(e)},s.Languages=i.languages,s.Language=i.getByLCID(localStorage.getItem("lcid")),void 0!==s.Language&&"rtl"==s.Language.direction&&$('link[id="languageCssfile"]').attr("href","styles/bootstrap.rtl.css"),s.SetLanguage=function(){i.set(s.Language).$promise.then(function(e){if(o.use(s.Language.shortname),o.preferredLanguage(s.Language.shortname),o.fallbackLanguage(s.Language.shortname),o.refresh(),localStorage.setItem("lcid",s.Language.lcid),void 0!==s.Language&&"rtl"==s.Language.direction)$('link[id="languageCssfile"]').attr("href","styles/bootstrap.rtl.css");else if(void 0!==a.theme){var t="themes/"+a.theme+"/bootstrap.min.css";$('link[id="languageCssfile"]').attr("href",t)}})},s.Theme=a.theme,s.Themes=["amelia","blooming","cerulean","desert","paper","green","readable","simplex","spacelab","Liquorice Schnitzel","flat","cyborg","United","superhero","journal","Lumen"];var l=localStorage.getItem("theme");null!==l&&void 0!==l?s.Theme=l:s.Theme="default",e.$watch("modal.Theme",function(e,t){if(void 0!==e){var n="themes/"+e+"/bootstrap.min.css";$('link[id="mainthemefile"]').attr("href",n),localStorage.setItem("theme",e)}}),e.modal=s}]);DynamicData.filter("filterpicker",["$filter",function(e){return function(t,n){return e(n)(t)}}]),DynamicData.filter("text",function(e){return function(e,t){return e}}),DynamicData.controller("Directives.BaseController",["$scope","$rootScope","$Models","$Broker","$Cache",function(e,t,n,i,a){e.Admin=e.$root.Admin,e.cahce=a,e.$Broker=i,e.ApplyData=function(){e.model=e.FieldName,void 0===t.models&&(t.models={}),void 0!==n.Models[e.db._id]?e.ComplexType=n.ResolvePropertyValue(e.FieldName,e.db._id,e.tab):e.ComplexType={},void 0!==e.dataId&&(e.ComplexType.input=e.$Broker.Objects[e.schemaName+"_"+e.dataId][e.FieldName]),void 0!==e.ComplexType&&e.$watch("ComplexType",function(t,n){e.$Broker.set(e.schemaName,e.dataId,e.FieldName,t)},!0)}}]),function(){angular.module("m43nu.auto-height",[]).directive("autoHeight",["$window","$timeout",function(e,t){return{link:function(n,i,a){var o,r;return o=function(e){var t,n,i,a;for(t=0,n=0,i=e.length;i>n;n++)a=e[n],t+=a.offsetHeight;return t},r=function(e){var t,n,i,a,o;for(a=e.parent().children(),o=[],n=0,i=a.length;i>n;n++)t=a[n],t!==e[0]&&o.push(t);return o},angular.element(e).bind("resize",function(){var t,n;return t=a.additionalHeight||0,n=e.innerHeight-i.parent()[0].getBoundingClientRect().top,i.css("height",n-o(r(i))-t+"px")}),t(function(){return angular.element(e).triggerHandler("resize")},1e3)}}}])}.call(this),DynamicData.directive("metaData",["RecursionHelper","$compile",function(e,t){return{restrict:"E",templateUrl:"partials/DirectivesTemplates/metaData.html"}}]),angular.module("nodulus").controller("ideController",["$scope","$User","$TreeMenu","$resource","$location","$compile","$Language","$mdSidenav","$mdBottomSheet","$Theme","$mdDialog","$Cache","$IDE",function(e,t,n,i,a,o,r,s,l,c,u,d,m){e.$Theme=c,e.$User=t,e.$TreeMenu=n,e.$IDE=m,e.$Language=r,void 0!==localStorage.getItem("ApiUser")&&(e.User=JSON.parse(localStorage.getItem("ApiUser")),e.Logoff=function(){e.User=null,localStorage.setItem("ApiUser",null),a.path("/login")}),void 0!==e.User&&null!=e.User||a.path("/login"),e.TreeLoading=!1,e.ShowSettings=!1,e.toggleRight=function(){e.ShowSettings=!e.ShowSettings},e.GetLanguageName=function(e){return r.getByLCID(e).name},e.ActiveTreeNode={},e.selectedTabIndex=0,e.EditItem=function(t){t.Name=t.name;var n="b"+t.boneid+"n"+t.nsid+"o"+t.objid+"l"+t.lcid;if(null!=e.TabByKey(n))return void e.focusMe(n);t.itemKey=n,e.Tabs.push(t);var i=$("<div data-egen-page itemkey='"+n+"' boneid='"+t.boneid+"' objid='"+t.objid+"' nsid='"+t.nsid+"' lcid='"+t.lcid+"'></div>"),a=$("<div></div>");a.append(i),$("#TabContainer").append(a);angular.element(i);o(a.contents())(e),e.focusMe(n)},e.showSelected=function(e){var t={_id:e._id,name:e.Name,schemaid:e._id};m.ShowLobby(t,e.Url)},e.loadSelected=function(t,n){void 0!==t&&n&&null!=t.Children&&void 0===t.Children.length&&(e.TreeLoading=!0,e.subTreeResource.get({ParentId:t.Id,skeletonid:t.skeletonId,lcid:1037},function(n){t.Children=n.items,e.TreeLoading=!1}))},e.showTreeBottomSheet=function(t,n){e.alert="",l.show({templateUrl:"partials/TreeMenu.html",controller:"TreeMenuCtrl",targetEvent:t}).then(function(e){e.method(t)})},n.initTreeMenu(),e.SetActiveMenu=function(t){e.ActiveMenu=t},e.ActiveMenu=null,e.Refresh=function(e){var t=angular.element("#"+e.itemKey+" div[ng-controller]").scope().refresh;t&&t()}}]).controller("CategoryDialog",["$scope","$resource","$location","$compile","$mdDialog","$Theme","$Config","$EditCategory","$NodeCollection","$rootScope","$Cache",function(e,t,n,i,a,o,r,s,l,c,u){e.EditCategory=s;var d=t(apiUrl+"/Navigation/",{},{get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},update:{method:"PUT"},delete:{method:"DELETE"}});e.ParentCategory=null,e.LoadData=function(t){e.RequestActive=!0,d.get({boneid:t},function(t){e.EditCategory=t})},e.LoadForParent=function(t){e.RequestActive=!0,d.get({boneid:t},function(t){e.RequestActive=!1,e.Results=t.d})},e.Update=function(){e.RequestActive=!0,d.save(e.EditCategory,function(t){l.push(e.EditCategory),e.RequestActive=!1,a.hide()})},e.Cancel=function(){a.hide()}}]).controller("SettingsCtrl",["$rootScope","$scope","$TreeMenu","$resource","$mdDialog","$Alerts","$location","$compile","$Language","$mdSidenav","$mdBottomSheet","$Theme","$translate","$IDE",function(e,t,n,i,a,o,r,s,l,c,u,d,m,g){t.Languages=l.languages,t.Language=l.getByLCID(localStorage.getItem("lcid")),void 0!==t.Language&&"rtl"==t.Language.direction&&$('link[id="languageCssfile"]').attr("href","styles/bootstrap.rtl.css"),t.SetLanguage=function(){l.set(t.Language).$promise.then(function(e){if(m.use(t.Language.shortname),m.preferredLanguage(t.Language.shortname),m.fallbackLanguage(t.Language.shortname),m.refresh(),localStorage.setItem("lcid",t.Language.lcid),void 0!==t.Language&&"rtl"==t.Language.direction)$('link[id="languageCssfile"]').attr("href","styles/bootstrap.rtl.css");else if(void 0!==d.theme){var n="themes/"+d.theme+"/bootstrap.min.css";$('link[id="languageCssfile"]').attr("href",n)}})},t.Theme=d.theme,t.Themes=["amelia","blooming","cerulean","desert","paper","green","readable","simplex","spacelab","Liquorice Schnitzel","flat","cyborg","United","superhero","journal","Lumen"];var h=localStorage.getItem("theme");null!==h&&void 0!==h?t.Theme=h:t.Theme="default",t.$watch("Theme",function(e,t){if(void 0!==e){var n="themes/"+e+"/bootstrap.min.css";$('link[id="mainthemefile"]').attr("href",n),localStorage.setItem("theme",e)}})}]).directive("egenLongClick",["$parse",function(e){return function(t,n,i){var a=e(i.egenLongClick);n.bind("contextmenu",function(e){t.$apply(function(){e.preventDefault(),a(t,{$event:e})})})}}]).directive("anyDialog",function(){return{scope:!1,replace:!0,templateUrl:"partials/dialog.html",link:function(e,t,n,i){var a=angular.module("nodulus")._invokeQueue.length,o=n.anyDialog.replace(".aspx",".js"),r=n.anyDialog.replace(".aspx","controller").toLowerCase();o=o.replace(".html",".js"),$.ajax({async:!1,url:"partials/manage/"+o,dataType:"script"});var s=n.anyDialog.replace(".aspx",".html");e.InsidePartial="partials/manage/"+s,e.PaneHeight=$(window).height()-100,window.onresize=function(){e.PaneHeight=$(window).height()-100},t.append('<div static-include="'+e.InsidePartial+"\" aria-label='xxxx'></div> ");for(var l=angular.module("nodulus")._invokeQueue,c=a;c<l.length;c++){var u=l[c-1];try{u[2][0].toLowerCase()!=r&&(u=l[c])}catch(e){}var d=providers[u[0]];d&&d[u[1]].apply(d,u[2])}t.injector().invoke(["$compile",function(n){n(t.contents())(e),t.scope().ParentCategory=e.ParentCategory}])}}}).directive("anyLobby",["$compile",function(e){return{templateUrl:"partials/any.html",link:function(e,t,n,i){var a=angular.module("nodulus")._invokeQueue.length,o=n.anyLobby.replace(".aspx",".js"),r=n.anyLobby.replace(".aspx","controller").toLowerCase();o=o.replace(".html",".js"),$.ajax({async:!1,url:o,dataType:"script"}),e.PaneHeight=$(window).height()-100,window.onresize=function(){e.PaneHeight=$(window).height()-100};var s=n.anyLobby.replace(".aspx",".html");e.InsidePartial=s,$("div",t).html("<div ng-include=\"'"+e.InsidePartial+"'\" aria-label=''></div> ");for(var l=angular.module("nodulus")._invokeQueue,c=a;c<l.length;c++){var u=l[c-1];try{u[2][0].toLowerCase()!=r&&(u=l[c])}catch(e){}var d=providers[u[0]];d&&d[u[1]].apply(d,u[2],e)}t.injector().invoke(["$compile",function(n){n(t.contents())(e)}],this,e)},scope:{itemobject:"@itemobject",itemKey:"@itemkey",schemaid:"@",lcid:"@lcid",editItem:"&editItem"}}}]).directive("staticInclude",["$timeout","$http","$templateCache","$compile","$parse",function(e,t,n,i,a){return{replace:!0,link:function(o,r,s){s.$observe("staticInclude",function(l,c){var u=s.staticInclude;""!=u&&e(function(){t.get(u,{cache:n}).success(function(e){if(!(e.indexOf("<html")>-1)){var t=r.html(e).contents();i(t)(o);var n=a(s.complete);n(o)}})},100)})}}}]).directive("egenPage",function(){return{templateUrl:"partials/page.html",controller:"pageController",scope:{itemkey:"@itemkey",nsid:"@nsid",lcid:"@lcid",objid:"@objid",boneid:"@boneid",editItem:"&editItem"}}}).directive("spinner",function(){return{restrict:"E",template:'<div class="spinner">      <div class="rect1"></div>      <div class="rect2"></div>      <div class="rect3"></div>      <div class="rect4"></div>      <div class="rect5"></div>    </div>'}}).directive("imageTransform",function(){return{require:"ngModel",templateUrl:"partials/directives/image-transform.html",link:function(e,t,n,i){$(t).parents(".fileinput-button").siblings("span").html("<img src='"+e.ImageString+"' style='max-width: 90px'/>")},controller:["$scope",function(e){e.ConvertFile=function(t){e.imagePreview("",t,e)},e.imagePreview=function(e,t,n){var i=t;if(i&&"files"in i&&i.files&&i.files.length>0&&i.files[0]){if("type"in i.files[0]&&!i.files[0].type.match("image.*"))return;if(!FileReader)return;var a=new FileReader;a.onload=function(e){return function(e){n.ImageString=e.target.result,n.$apply(n.ImageString),$(t).parents(".fileinput-button").siblings("span").html("<img src='"+e.target.result+"' style='max-width: 90px'/>")}}(i.files[0]),a.onerror=function(){},a.onabort=function(){},a.readAsDataURL(i.files[0])}}}],scope:{ImageString:"=image"}}}).controller("pageController",["$scope","$resource","$location","$compile","$http","$Status","$Language",function(e,t,n,i,a,o,r){a.defaults.useXDomain=!0,e.Statuses=o(),e.ItemLoading=!0,e.IsSaving=!1,e.GetObject={},e.SetObject={},e.reconstruct=function(e,t,n){var i={};for(var a in e)0==a.indexOf(t+"_")&&(i[a.replace(t+"_","")]=e[a]);return i!=={}&&(e[t]=i),e.tablename=n,e},e.fieldcount=function(e,t,n){for(var i=0,a=0;a<e.length;a++)e[a].FieldName==t&&e[a].tablename==n&&i++;return i};var s=t(apiUrl+"/schemas/",{nsid:"@nsid"}),l=t(apiUrl+"/Item/",{boneid:"@boneid",nsid:"@nsid",objid:"@objid",lcid:"@lcid"});e.updateitemResource=t(apiUrl+"/Item/",{updateObject:"@updateObject"});var c="";s.get({nsid:e.nsid},function(t){e.tempSchema=t.Schema,c=t.Display,l.get({boneid:e.boneid,nsid:e.nsid,objid:e.objid,lcid:e.lcid},function(t){for(var n=JSON.parse(t.ItemJson),i=0;i<e.tempSchema.length;i++){null!=e.SetObject&&void 0!==e.SetObject||(e.SetObject={}),void 0===e.SetObject[e.tempSchema[i].tablename]&&(e.SetObject[e.tempSchema[i].tablename]={});var a="";e.fieldcount(e.tempSchema,e.tempSchema[i].FieldName,e.tempSchema[i].tablename)>1?(n=e.reconstruct(n,e.tempSchema[i].FieldName,e.tempSchema[i].tablename),e.SetObject[e.tempSchema[i].tablename][e.tempSchema[i].FieldName+"_"+e.tempSchema[i].propName]=n[e.tempSchema[i].FieldName][e.tempSchema[i].propName]):(n=e.reconstruct(n,"",e.tempSchema[i].tablename),a=e.tempSchema[i].FieldName,e.SetObject[e.tempSchema[i].tablename][e.tempSchema[i].FieldName]=n[a]),e.tempSchema[i].FieldValue=n[e.tempSchema[i].FieldName]}e.SetObject.ObjId=e.objid,e.SetObject.NsId=e.nsid,e.SetObject.LCID=e.lcid,e.SetObject.BoneId=e.boneid,e.GetObject=n,e.Schema=e.tempSchema,e.Display=c,e.ItemLoading=!1})}),e.Save=function(){e.IsSaving=!0,e.updateitemResource.save({updateObject:JSON.stringify(e.SetObject)},function(){e.IsSaving=!1})}}]).service("$TreeMenu",["$resource","$mdDialog","$mdBottomSheet",function(e,t,n){var i=e("/@nodulus/modules/listnav"),a=this;a.initTreeMenu=function(){i.query(function(e){a.Menus=[];for(var t=0;t<e.length;t++)e[t].module=e[t].module.name,a.Menus.push(e[t]);a.treeOptions={nodeChildren:"Children"}})},$("#sidebar").on("contextmenu","a",function(e){var t=angular.element("html").scope();t.$apply(function(){for(var t=angular.element(e.toElement).scope(),n=angular.element(e.toElement).scope();void 0===t.$parent.menu&&void 0!==t.$parent;)t=t.$parent;void 0!==t.$parent.menu&&(t=t.$parent.menu),e.preventDefault(),null!==t&&t.showTreeBottomSheet({event:e,node:n.row.branch})})})}]),angular.module("Cache",[]).service("$Cache",["$resource","$Config",function(e,t){var n=this,i="@nodulus/api/";this.setState=function(e,t){void 0===this.states[e]?this.states[e]={callbacks:[],status:t}:this.states[e].state=t},this.states={},this.ready=function(t,a,o){if(void 0===this.states[t]&&(this.states[t]={callbacks:[],status:"empty"}),isFunction(a))switch(o=a,this.states[t].status){case"empty":this.states[t].status="loading";var r=e(i+t);r.get({},function(e){if(null!=e&&e.items){for(var i={},a=0;a<e.items.length;a++)i[e.items[a]._id]=e.items[a];n[t]=i,n.states[t].status="ready",o(toArray(n[t]));for(var a=0;a<n.states[t].callbacks.length;a++)n.states[t].callbacks[a](toArray(n[t]))}});break;case"loading":this.states[t].callbacks.push(o);break;case"ready":o(toArray(n[t]))}else{void 0===this[t]&&(this[t]={});for(var s=[],l=0;l<a.length;l++)void 0!==this[t][a[l]]&&s.push(this[t][a[l]]);for(var l=0;l<s.length;l++){var c=a.indexOf(s[l]._id);c>-1&&a.splice(c,1)}0==a.length&&o(s);for(var l=0;l<a.length;l++){var r=e(i+t);r.get({_id:a[l]},function(e){for(var i=0;i<e.items.length;i++)n[t][e.items[i]._id]=e.items[i],s.push(e.items[i]);a.length===l&&o(s)})}}},this.setCache=function(e,t){this.states[e]={state:"ready"},this[e]=t}}]).service("$Models",["$resource","$rootScope",function(e,t){function n(e,t,n){lastKeyIndex=t.length-1;for(var i=0;i<lastKeyIndex;++i)key=t[i],key in e||(e[key]={}),e=e[key];return void 0===e[t[lastKeyIndex]]?e[t[lastKeyIndex]]=n:e[t[lastKeyIndex]]}this.Models={};var i=e(apiUrl+"schemas");this.getSchemas=function(e){i.get({_id:e},function(e){this.db=e.items[0],t=e.items[0]},function(e){console.log("error")})},this.getSchemasByName=function(e,n){i.get({name:e},function(e){this.db=e.items[0],t=e.items[0],n(e.items[0])},function(e){console.log("error")})},this.ResolvePropertyValue=function(e,t,i){var a=e.split(".");if(this.Models[t])return n(this.Models[t],a,{})},this.Set=function(e,t,n){void 0===this.Models[e]&&(this.Models[e]={});for(var i=t.split("."),a=this.Models[e],o=0;o<i.length;o++)a[i[o]]={},o<i.length-1?a=a[i[o]]:a[i[o]]=n}}]).service("$Broker",["$resource","$Config","$Models",function(e,t,n){function i(e){for(var t in e)angular.isObject(e[t])?i(e[t]):e[t]=reviveType(e[t]);return e}var a=this;a.Models=n,this.Objects={},this.get=function(){for(var e in this.Objects)return this.Objects[e]},this.ready=function(t,n,o){var r=e(apiUrl+t);r.get({_id:n},function(e){e.items.length>0?a.Objects[t+"_"+n]=i(e.items[0]):a.Objects[t+"_"+n]={_id:n},o(a.Objects[t+"_"+n])})},this.set=function(e,t,n,i){var a=e+"_"+t;void 0===this.Objects[a]&&(this.Objects[a]={});for(var o=n.split("."),r=this.Objects[a],s=0;s<o.length;s++)r[o[s]]={},s<o.length-1?r=r[o[s]]:r[o[s]]=i}}]);var regexIso8601=/^(\d{4}|\+\d{6})(?:-(\d{2})(?:-(\d{2})(?:T(\d{2}):(\d{2}):(\d{2})\.(\d{1,})(Z|([\-+])(\d{2}):(\d{2}))?)?)?)?$/;angular.module("DynamicDataSerivces",[]).service("$Models",["$resource","$rootScope",function(e,t){function n(e,t,n){lastKeyIndex=t.length-1;for(var i=0;i<lastKeyIndex;++i)key=t[i],key in e||(e[key]={}),e=e[key];return void 0===e[t[lastKeyIndex]]?e[t[lastKeyIndex]]=n:e[t[lastKeyIndex]]}this.Models={};var i=e("@nodulus/api/schemas");this.getSchemas=function(e){i.get({_id:e},function(e){this.db=e.items[0],t=e.items[0]},function(e){console.log("error")})},this.ResolvePropertyValue=function(e,t,i){var a=e.split(".");if(this.Models[t])return n(this.Models[t],a,{})},this.Set=function(e,t,n){void 0===this.Models[e]&&(this.Models[e]={});for(var i=t.split("."),a=this.Models[e],o=0;o<i.length;o++)a[i[o]]={},o<i.length-1?a=a[i[o]]:a[i[o]]=n}}]),angular.module("IDE",[]).service("$IDE",["$resource","$rootScope","$compile",function(e,t,n){var i=this;this.ActiveTreeNode={},this.Tabs=[],this.TabsObject={},this.setDirty=function(e){this.TabsObject[e].dirty=!0},this.clearDirty=function(e){this.TabsObject[e].dirty=!1},this.ShowLobby=function(e,t){if(i.ActiveTreeNode=e,null!=e){if(void 0!==e.label&&(e.name=e.label),void 0===e.itemKey&&(e.itemKey="b_"+e._id),null!=i.TabByKey(e.itemKey))return void i.focusMe(e.itemKey);e.disabled=!1,e.style="lobby-tab";var a=$("<div id='"+e.itemKey+"' data-any-lobby=\""+t+"\" itemkey='"+e.itemKey+"' schemaid='"+e.schemaid+"'></div>"),o=$("<div></div>");o.append(a),$("#TabContainer").append(o);var r=angular.element(a);i.Tabs.push(e),i.TabsObject[e.itemKey]=e;var s=r.scope();s.item=e,n(o.contents())(s),i.focusMe(e.itemKey)}},this.focusMe=function(e){$("div[data-egen-page], div[data-egen-lobby],div[data-any-lobby]").hide(),$("div[itemkey='"+e+"']").show();for(var t=0;t<i.Tabs.length;t++)i.Tabs[t].itemKey==e&&(i.selectedTabIndex=t,i.ActiveTreeNode=i.Tabs[t])},this.CloseTab=function(e){$("div[itemkey = '"+e.itemKey+"']").remove();for(var t=0;t<i.Tabs.length;t++)if(i.Tabs[t].itemKey===e.itemKey){i.Tabs.splice(t,1);var n=t;t>1?n=t-1:1===i.Tabs.length&&(n=0),void 0!==i.Tabs[n]&&i.focusMe(i.Tabs[n].itemKey)}},this.onTabSelected=function(e,t){i.focusMe(e.itemKey),t?2==t.which&&i.CloseTab(e):4==t.button&&i.CloseTab(e)},this.TabByKey=function(e){for(var t=0;t<this.Tabs.length;t++)if(this.Tabs[t].itemKey==e)return this.Tabs[t];return null}}]);